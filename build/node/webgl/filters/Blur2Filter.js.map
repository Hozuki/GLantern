{"version":3,"sources":["webgl/filters/Blur2Filter.ts"],"names":[],"mappings":"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","file":"webgl/filters/Blur2Filter.js","sourcesContent":["/**\r\n * Created by MIC on 2015/12/22.\r\n */\r\n\r\nimport {RenderTarget2D} from \"../RenderTarget2D\";\r\nimport {WebGLRenderer} from \"../WebGLRenderer\";\r\nimport {FilterManager} from \"../FilterManager\";\r\nimport {FilterBase} from \"../FilterBase\";\r\nimport {RenderHelper} from \"../RenderHelper\";\r\nimport {ShaderID} from \"../ShaderID\";\r\nimport {Blur2Shader} from \"../shaders/Blur2Shader\";\r\nimport {GLUtil} from \"../../GLUtil\";\r\n\r\nexport class Blur2Filter extends FilterBase {\r\n\r\n    constructor(manager:FilterManager) {\r\n        super(manager);\r\n        this._tempTarget = manager.renderer.createRenderTarget();\r\n    }\r\n\r\n    get strengthX():number {\r\n        return this._strengthX;\r\n    }\r\n\r\n    set strengthX(v:number) {\r\n        if (v < 0) {\r\n            v = 1;\r\n        }\r\n        this._strengthX = v;\r\n    }\r\n\r\n    get strengthY():number {\r\n        return this._strengthY;\r\n    }\r\n\r\n    set strengthY(v:number) {\r\n        if (v < 0) {\r\n            v = 1;\r\n        }\r\n        this._strengthY = v;\r\n    }\r\n\r\n    get pass():number {\r\n        return this._pass;\r\n    }\r\n\r\n    set pass(v:number) {\r\n        v = GLUtil.limitInto(v, 1, 3) | 0;\r\n        this._pass = v;\r\n    }\r\n\r\n    process(renderer:WebGLRenderer, input:RenderTarget2D, output:RenderTarget2D, clearOutput:boolean):void {\r\n        // Larger value makes image smoother, darker (or less contrastive), but greatly improves efficiency.\r\n        var passCoeff = 3;\r\n\r\n        // See http://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\r\n        var t1 = input, t2 = this._tempTarget;\r\n        t2.clear();\r\n        var t:RenderTarget2D;\r\n        for (var i = 0; i < this.pass * passCoeff; ++i) {\r\n            RenderHelper.renderBuffered(renderer, t1, t2, ShaderID.BLUR2, true, (renderer:WebGLRenderer):void => {\r\n                var shader = <Blur2Shader>renderer.shaderManager.currentShader;\r\n                shader.setStrength(this.strengthX / 4 / this.pass / (t1.fitWidth / t1.originalWidth));\r\n                shader.setResolution(input.fitWidth);\r\n                shader.setBlurDirection([1.0, 0.0]);\r\n            });\r\n            t = t1;\r\n            t1 = t2;\r\n            t2 = t;\r\n        }\r\n        for (var i = 0; i < this.pass * passCoeff; ++i) {\r\n            RenderHelper.renderBuffered(renderer, t1, t2, ShaderID.BLUR2, true, (renderer:WebGLRenderer):void => {\r\n                var shader = <Blur2Shader>renderer.shaderManager.currentShader;\r\n                shader.setStrength(this.strengthY / 4 / this.pass / (t1.fitWidth / t1.originalWidth));\r\n                shader.setResolution(input.fitHeight);\r\n                shader.setBlurDirection([0.0, 1.0]);\r\n            });\r\n            t = t1;\r\n            t1 = t2;\r\n            t2 = t;\r\n        }\r\n        RenderHelper.copyTargetContent(renderer, t1, output, this.flipX, this.flipY, clearOutput);\r\n    }\r\n\r\n    protected __initialize():void {\r\n        this._tempTarget = this.filterManager.renderer.createRenderTarget();\r\n    }\r\n\r\n    protected __dispose():void {\r\n        this.filterManager.renderer.releaseRenderTarget(this._tempTarget);\r\n        this._tempTarget = null;\r\n    }\r\n\r\n    private _tempTarget:RenderTarget2D = null;\r\n    private _strengthX:number = 5;\r\n    private _strengthY:number = 5;\r\n    private _pass:number = 1;\r\n\r\n}\r\n"],"sourceRoot":"/source/"}