{"version":3,"sources":["webgl/filters/Blur2Filter.ts"],"names":["Blur2Filter","Blur2Filter.constructor","Blur2Filter.strengthX","Blur2Filter.strengthY","Blur2Filter.pass","Blur2Filter.process","Blur2Filter.___initialize","Blur2Filter.___dispose"],"mappings":"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","file":"webgl/filters/Blur2Filter.js","sourcesContent":["/**\r\n * Created by MIC on 2015/12/22.\r\n */\r\n\r\nimport {RenderTarget2D} from \"../RenderTarget2D\";\r\nimport {WebGLRenderer} from \"../WebGLRenderer\";\r\nimport {_util} from \"../../_util/_util\";\r\nimport {FilterManager} from \"../FilterManager\";\r\nimport {FilterBase} from \"../FilterBase\";\r\nimport {RenderHelper} from \"../RenderHelper\";\r\nimport {ShaderID} from \"../ShaderID\";\r\nimport {Blur2Shader} from \"../shaders/Blur2Shader\";\r\n\r\nexport class Blur2Filter extends FilterBase {\r\n\r\n    constructor(manager:FilterManager) {\r\n        super(manager);\r\n        this._tempTarget = manager.renderer.createRenderTarget();\r\n    }\r\n\r\n    get strengthX():number {\r\n        return this._strengthX;\r\n    }\r\n\r\n    set strengthX(v:number) {\r\n        if (v < 0) {\r\n            v = 1;\r\n        }\r\n        this._strengthX = v;\r\n    }\r\n\r\n    get strengthY():number {\r\n        return this._strengthY;\r\n    }\r\n\r\n    set strengthY(v:number) {\r\n        if (v < 0) {\r\n            v = 1;\r\n        }\r\n        this._strengthY = v;\r\n    }\r\n\r\n    get pass():number {\r\n        return this._pass;\r\n    }\r\n\r\n    set pass(v:number) {\r\n        v = _util.limitInto(v, 1, 3) | 0;\r\n        this._pass = v;\r\n    }\r\n\r\n    process(renderer:WebGLRenderer, input:RenderTarget2D, output:RenderTarget2D, clearOutput:boolean):void {\r\n        // Larger value makes image smoother, darker (or less contrastive), but greatly improves efficiency.\r\n        var passCoeff = 3;\r\n\r\n        // See http://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\r\n        var t1 = input, t2 = this._tempTarget;\r\n        t2.clear();\r\n        var t:RenderTarget2D;\r\n        for (var i = 0; i < this.pass * passCoeff; ++i) {\r\n            RenderHelper.renderBuffered(renderer, t1, t2, ShaderID.BLUR2, true, (renderer:WebGLRenderer):void => {\r\n                var shader = <Blur2Shader>renderer.shaderManager.currentShader;\r\n                shader.setStrength(this.strengthX / 4 / this.pass / (t1.fitWidth / t1.originalWidth));\r\n                shader.setResolution(input.fitWidth);\r\n                shader.setBlurDirection([1.0, 0.0]);\r\n            });\r\n            t = t1;\r\n            t1 = t2;\r\n            t2 = t;\r\n        }\r\n        for (var i = 0; i < this.pass * passCoeff; ++i) {\r\n            RenderHelper.renderBuffered(renderer, t1, t2, ShaderID.BLUR2, true, (renderer:WebGLRenderer):void => {\r\n                var shader = <Blur2Shader>renderer.shaderManager.currentShader;\r\n                shader.setStrength(this.strengthY / 4 / this.pass / (t1.fitWidth / t1.originalWidth));\r\n                shader.setResolution(input.fitHeight);\r\n                shader.setBlurDirection([0.0, 1.0]);\r\n            });\r\n            t = t1;\r\n            t1 = t2;\r\n            t2 = t;\r\n        }\r\n        //renderer.copyRenderTargetContent(t1, output, clearOutput);\r\n        RenderHelper.copyTargetContent(renderer, t1, output, this.flipX, this.shouldFlipY(output), clearOutput);\r\n    }\r\n\r\n    protected __initialize():void {\r\n        this._tempTarget = this.filterManager.renderer.createRenderTarget();\r\n    }\r\n\r\n    protected __dispose():void {\r\n        this.filterManager.renderer.releaseRenderTarget(this._tempTarget);\r\n        this._tempTarget = null;\r\n    }\r\n\r\n    private _tempTarget:RenderTarget2D = null;\r\n    private _strengthX:number = 5;\r\n    private _strengthY:number = 5;\r\n    private _pass:number = 1;\r\n\r\n}\r\n"],"sourceRoot":"/source/"}