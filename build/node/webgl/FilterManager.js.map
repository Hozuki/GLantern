{"version":3,"sources":["webgl/FilterManager.ts"],"names":[],"mappings":"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","file":"webgl/FilterManager.js","sourcesContent":["/**\r\n * Created by MIC on 2015/11/17.\r\n */\r\n\r\nimport {WebGLRenderer} from \"./WebGLRenderer\";\r\nimport {RenderTarget2D} from \"./RenderTarget2D\";\r\nimport {IDisposable} from \"../IDisposable\";\r\nimport {IBitmapFilter} from \"./IBitmapFilter\";\r\nimport {RenderHelper} from \"./RenderHelper\";\r\n\r\nexport class FilterManager implements IDisposable {\r\n\r\n    constructor(renderer:WebGLRenderer) {\r\n        this._renderer = renderer;\r\n        this._filterGroups = [];\r\n        this._tempTarget = renderer.createRenderTarget();\r\n    }\r\n\r\n    dispose():void {\r\n        this._renderer.releaseRenderTarget(this._tempTarget);\r\n        this.clearFilterGroups();\r\n        this._tempTarget = null;\r\n        this._filterGroups = null;\r\n        this._renderer = null;\r\n    }\r\n\r\n    clearFilterGroups():void {\r\n        var filterGroup:IBitmapFilter[];\r\n        var filterGroups = this._filterGroups;\r\n        if (filterGroups.length > 0) {\r\n            for (var i = 0; i < filterGroups.length; ++i) {\r\n                filterGroup = filterGroups[i];\r\n                while (filterGroup.length > 0) {\r\n                    filterGroup.pop();\r\n                }\r\n            }\r\n        }\r\n        while (filterGroups.length > 0) {\r\n            filterGroups.pop();\r\n        }\r\n    }\r\n\r\n    pushFilterGroup(group:IBitmapFilter[]):void {\r\n        this._filterGroups.push(group.slice());\r\n    }\r\n\r\n    popFilterGroup():IBitmapFilter[] {\r\n        return this.hasFilterGroups ? this._filterGroups.pop() : null;\r\n    }\r\n\r\n    get hasFilterGroups():boolean {\r\n        return this._filterGroups.length > 0;\r\n    }\r\n\r\n    get renderer():WebGLRenderer {\r\n        return this._renderer;\r\n    }\r\n\r\n    processFilters(renderer:WebGLRenderer, input:RenderTarget2D, output:RenderTarget2D, clearOutput:boolean):void {\r\n        if (input === output) {\r\n            console.warn(\"Filter alert: input and output are the same, processing aborted.\");\r\n            return;\r\n        }\r\n\r\n        if (this.hasFilterGroups) {\r\n            var filterGroup:IBitmapFilter[] = this._filterGroups[this._filterGroups.length - 1];\r\n            var filter:IBitmapFilter;\r\n            var t1 = input, t2 = this._tempTarget;\r\n            t2.clear();\r\n            var t:RenderTarget2D;\r\n            for (var i = 0; i < filterGroup.length; i++) {\r\n                filter = filterGroup[i];\r\n                if (filter !== null) {\r\n                    filter.process(renderer, t1, t2, true);\r\n                    t = t1;\r\n                    t1 = t2;\r\n                    t2 = t;\r\n                }\r\n            }\r\n            // Y-axis should be flipped from element to screen, due to the difference between OpenGL coordinate\r\n            // system and Flash coordinate system.\r\n            RenderHelper.copyTargetContent(renderer, t1, output, false, true, clearOutput);\r\n        }\r\n    }\r\n\r\n    private _tempTarget:RenderTarget2D = null;\r\n    private _renderer:WebGLRenderer = null;\r\n    private _filterGroups:IBitmapFilter[][] = null;\r\n\r\n}\r\n"],"sourceRoot":"/source/"}