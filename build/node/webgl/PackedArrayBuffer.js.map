{"version":3,"sources":["webgl/PackedArrayBuffer.ts"],"names":[],"mappings":"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","file":"webgl/PackedArrayBuffer.js","sourcesContent":["/**\r\n * Created by MIC on 2015/11/18.\r\n */\r\n\r\nimport {IDisposable} from \"../IDisposable\";\r\nimport {GLUtil} from \"../GLUtil\";\r\n\r\nvar gl = (<any>this).WebGLRenderingContext || (<any>window).WebGLRenderingContext;\r\n\r\nexport class PackedArrayBuffer implements IDisposable {\r\n\r\n    constructor() {\r\n    }\r\n\r\n    static create(context:WebGLRenderingContext, data:number[], elementGLType:number, bufferType:number):PackedArrayBuffer {\r\n        var T:any = PackedArrayBuffer.getTypedArrayType(elementGLType);\r\n        if (T === null) {\r\n            console.warn(\"Failed to create typed array whose elements are of WebGL type 0x\" + elementGLType.toString(16));\r\n            return null;\r\n        }\r\n        var wab = new PackedArrayBuffer();\r\n        wab._glc = context;\r\n        wab._elementGLType = elementGLType;\r\n        wab._webglBuffer = context.createBuffer();\r\n        if (wab._webglBuffer == null) {\r\n            console.warn(\"Failed to create WebGL buffer.\");\r\n            return null;\r\n        }\r\n        wab._arrayType = T;\r\n        wab._bufferType = bufferType;\r\n        wab.setNewData(data);\r\n        wab.becomeDirty();\r\n        wab.syncBufferData();\r\n        return wab;\r\n    }\r\n\r\n    get webglBuffer():WebGLBuffer {\r\n        return this._webglBuffer;\r\n    }\r\n\r\n    get elementSize():number {\r\n        return this._typedArray.BYTES_PER_ELEMENT;\r\n    }\r\n\r\n    get elementCount():number {\r\n        return this._typedArray.length;\r\n    }\r\n\r\n    get elementGLType():number {\r\n        return this._elementGLType;\r\n    }\r\n\r\n    setNewData(data:number[]):void {\r\n        if (GLUtil.isUndefinedOrNull(data)) {\r\n            this._array = [];\r\n        } else {\r\n            this._array = data.slice();\r\n        }\r\n    }\r\n\r\n    becomeDirty():void {\r\n        this._isDirty = true;\r\n    }\r\n\r\n    syncBufferData():void {\r\n        if (this._isDirty) {\r\n            var T:any = this._arrayType;\r\n            this._typedArray = new T(this._array);\r\n            this._isDirty = false;\r\n        }\r\n        this._glc.bindBuffer(this._bufferType, this._webglBuffer);\r\n        // DANGER! In complex scenes, bufferData() transfers large amount of data.\r\n        // Improper optimization does harm on performance.\r\n        this._glc.bufferData(this._bufferType, this._typedArray, gl.DYNAMIC_DRAW);\r\n    }\r\n\r\n    dispose():void {\r\n        this._glc.deleteBuffer(this._webglBuffer);\r\n        this._array = null;\r\n        this._typedArray = null;\r\n        this._webglBuffer = null;\r\n        this._glc = null;\r\n    }\r\n\r\n    static getTypedArrayType(glType:number):Function {\r\n        switch (glType) {\r\n            case gl.FLOAT:\r\n                return Float32Array;\r\n            case gl.UNSIGNED_SHORT:\r\n                return Uint16Array;\r\n            case gl.UNSIGNED_INT:\r\n                return Uint32Array;\r\n            case gl.UNSIGNED_BYTE:\r\n                return Uint8Array;\r\n            case gl.INT:\r\n                return Int32Array;\r\n            case gl.SHORT:\r\n                return Int16Array;\r\n            case gl.BYTE:\r\n                return Int8Array;\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    private _glc:WebGLRenderingContext = null;\r\n    private _isDirty:boolean = true;\r\n    private _bufferType:number = 0;\r\n    private _elementGLType:number = 0;\r\n    private _webglBuffer:WebGLBuffer = null;\r\n    private _array:number[] = null;\r\n    private _arrayType:Function = null;\r\n    private _typedArray:Int8Array | Uint8Array | Int16Array | Uint16Array | Int32Array | Uint32Array | Float32Array = null;\r\n\r\n}\r\n"],"sourceRoot":"/source/"}