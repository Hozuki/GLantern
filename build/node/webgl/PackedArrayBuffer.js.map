{"version":3,"sources":["webgl/PackedArrayBuffer.ts"],"names":["PackedArrayBuffer","PackedArrayBuffer.constructor","PackedArrayBuffer.create","PackedArrayBuffer.webglBuffer","PackedArrayBuffer.elementSize","PackedArrayBuffer.elementCount","PackedArrayBuffer.elementGLType","PackedArrayBuffer.setNewData","PackedArrayBuffer.becomeDirty","PackedArrayBuffer.syncBufferData","PackedArrayBuffer.dispose","PackedArrayBuffer.getTypedArrayType"],"mappings":"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","file":"webgl/PackedArrayBuffer.js","sourcesContent":["/**\r\n * Created by MIC on 2015/11/18.\r\n */\r\n\r\nimport {IDisposable} from \"../IDisposable\";\r\nimport {_util} from \"../_util/_util\";\r\n\r\nvar gl = (<any>this).WebGLRenderingContext || (<any>window).WebGLRenderingContext;\r\n\r\nexport class PackedArrayBuffer implements IDisposable {\r\n\r\n    constructor() {\r\n    }\r\n\r\n    static create(context:WebGLRenderingContext, data:number[], elementGLType:number, bufferType:number):PackedArrayBuffer {\r\n        var T:any = PackedArrayBuffer.getTypedArrayType(elementGLType);\r\n        if (T === null) {\r\n            console.warn(\"Failed to create typed array whose elements are of WebGL type 0x\" + elementGLType.toString(16));\r\n            return null;\r\n        }\r\n        var wab = new PackedArrayBuffer();\r\n        wab._glc = context;\r\n        wab._elementGLType = elementGLType;\r\n        wab._webglBuffer = context.createBuffer();\r\n        if (wab._webglBuffer == null) {\r\n            console.warn(\"Failed to create WebGL buffer.\");\r\n            return null;\r\n        }\r\n        wab._arrayType = T;\r\n        wab._bufferType = bufferType;\r\n        wab.setNewData(data);\r\n        wab.becomeDirty();\r\n        wab.syncBufferData();\r\n        return wab;\r\n    }\r\n\r\n    get webglBuffer():WebGLBuffer {\r\n        return this._webglBuffer;\r\n    }\r\n\r\n    get elementSize():number {\r\n        return this._typedArray.BYTES_PER_ELEMENT;\r\n    }\r\n\r\n    get elementCount():number {\r\n        return this._typedArray.length;\r\n    }\r\n\r\n    get elementGLType():number {\r\n        return this._elementGLType;\r\n    }\r\n\r\n    setNewData(data:number[]):void {\r\n        if (_util.isUndefinedOrNull(data)) {\r\n            this._array = [];\r\n        } else {\r\n            this._array = data.slice();\r\n        }\r\n    }\r\n\r\n    becomeDirty():void {\r\n        this._isDirty = true;\r\n    }\r\n\r\n    syncBufferData():void {\r\n        if (this._isDirty) {\r\n            var T:any = this._arrayType;\r\n            this._typedArray = new T(this._array);\r\n            this._isDirty = false;\r\n        }\r\n        this._glc.bindBuffer(this._bufferType, this._webglBuffer);\r\n        // DANGER! In complex scenes, bufferData() transfers large amount of data.\r\n        // Improper optimization does harm on performance.\r\n        this._glc.bufferData(this._bufferType, this._typedArray, gl.DYNAMIC_DRAW);\r\n    }\r\n\r\n    dispose():void {\r\n        this._glc.deleteBuffer(this._webglBuffer);\r\n        this._array = null;\r\n        this._typedArray = null;\r\n        this._webglBuffer = null;\r\n        this._glc = null;\r\n    }\r\n\r\n    static getTypedArrayType(glType:number):Function {\r\n        switch (glType) {\r\n            case gl.FLOAT:\r\n                return Float32Array;\r\n            case gl.UNSIGNED_SHORT:\r\n                return Uint16Array;\r\n            case gl.UNSIGNED_INT:\r\n                return Uint32Array;\r\n            case gl.UNSIGNED_BYTE:\r\n                return Uint8Array;\r\n            case gl.INT:\r\n                return Int32Array;\r\n            case gl.SHORT:\r\n                return Int16Array;\r\n            case gl.BYTE:\r\n                return Int8Array;\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    private _glc:WebGLRenderingContext = null;\r\n    private _isDirty:boolean = true;\r\n    private _bufferType:number = 0;\r\n    private _elementGLType:number = 0;\r\n    private _webglBuffer:WebGLBuffer = null;\r\n    private _array:number[] = null;\r\n    private _arrayType:Function = null;\r\n    private _typedArray:Int8Array | Uint8Array | Int16Array | Uint16Array | Int32Array | Uint32Array | Float32Array = null;\r\n\r\n}\r\n"],"sourceRoot":"/source/"}