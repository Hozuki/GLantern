{"version":3,"sources":["webgl/ShaderBase.ts"],"names":[],"mappings":"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","file":"webgl/ShaderBase.js","sourcesContent":["/**\r\n * Created by MIC on 2015/11/18.\r\n */\r\n\r\nimport {AttributeCache} from \"./AttributeCache\";\r\nimport {UniformCache} from \"./UniformCache\";\r\nimport {ShaderManager} from \"./ShaderManager\";\r\nimport {VertexShaders} from \"./VertexShaders\";\r\nimport {FragmentShaders} from \"./FragmentShaders\";\r\nimport {IDisposable} from \"../IDisposable\";\r\nimport {WebGLDataType} from \"./WebGLDataType\";\r\nimport {GLUtil} from \"../GLUtil\";\r\n\r\nvar gl = (<any>this).WebGLRenderingContext || (<any>window).WebGLRenderingContext;\r\n\r\nexport class ShaderBase implements IDisposable {\r\n\r\n    constructor(manager:ShaderManager, vertexSource:string, fragmentSource:string,\r\n                uniforms:Map<string, UniformCache>, attributes:Map<string, AttributeCache>) {\r\n        this._shaderManager = manager;\r\n        this._vertexSource = vertexSource;\r\n        this._fragmentSource = fragmentSource;\r\n        this._id = manager.getNextAvailableID();\r\n        this.__initialize(manager.context, vertexSource, fragmentSource);\r\n        this.select();\r\n        if (GLUtil.isUndefinedOrNull(uniforms) || GLUtil.isUndefinedOrNull(attributes)) {\r\n            this._uniforms = new Map<string, UniformCache>();\r\n            this._attributes = new Map<string, AttributeCache>();\r\n            this.__localInit(manager, this._uniforms, this._attributes);\r\n        } else {\r\n            this._uniforms = uniforms;\r\n            this._attributes = attributes;\r\n        }\r\n        this.__cacheUniformLocations();\r\n        this.__cacheAttributeLocations();\r\n        this.syncUniforms();\r\n    }\r\n\r\n    get id():number {\r\n        return this._id;\r\n    }\r\n\r\n    dispose():void {\r\n        var glc = this._glc;\r\n        glc.deleteProgram(this._program);\r\n        glc.deleteShader(this._vertexShader);\r\n        glc.deleteShader(this._fragmentShader);\r\n        this._glc = null;\r\n        this._uniforms = null;\r\n        this._attributes = null;\r\n        this._vertexShader = null;\r\n        this._fragmentShader = null;\r\n        this._vertexSource = null;\r\n        this._fragmentSource = null;\r\n        this._shaderManager = null;\r\n    }\r\n\r\n    syncUniforms():void {\r\n        this._uniforms.forEach((v):void => {\r\n            this.__syncUniform(v);\r\n        });\r\n    }\r\n\r\n    changeValue(name:string, callback:(uniform:UniformCache) => void):void {\r\n        var uniform = this._uniforms.get(name);\r\n        if (uniform !== undefined && uniform !== null) {\r\n            callback(uniform);\r\n        }\r\n    }\r\n\r\n    select():void {\r\n        this._glc.useProgram(this._program);\r\n    }\r\n\r\n    getUniformLocation(name:string):WebGLUniformLocation {\r\n        return this._program !== null ? this._glc.getUniformLocation(this._program, name) : null;\r\n    }\r\n\r\n    getAttributeLocation(name:string):number {\r\n        return this._program !== null ? this._glc.getAttribLocation(this._program, name) : -1;\r\n    }\r\n\r\n    get vertexSource():string {\r\n        return this._vertexSource\r\n    }\r\n\r\n    get fragmentSource():string {\r\n        return this._fragmentSource;\r\n    }\r\n\r\n    static SHADER_CLASS_NAME:string = \"ShaderBase\";\r\n    static FRAGMENT_SOURCE:string = FragmentShaders.buffered;\r\n    static VERTEX_SOURCE:string = VertexShaders.buffered;\r\n\r\n    private __initialize(glc:WebGLRenderingContext, vertexSource:string, fragmentSource:string):void {\r\n        this._glc = glc;\r\n\r\n        function error(message:string, extra?:any):void {\r\n            if (this._vertexShader !== null) {\r\n                glc.deleteShader(this._vertexShader);\r\n            }\r\n            if (this._fragmentShader !== null) {\r\n                glc.deleteShader(this._fragmentShader);\r\n            }\r\n            if (this._program !== null) {\r\n                glc.deleteProgram(this._program);\r\n            }\r\n            this._vertexShader = this._fragmentShader = this._program = null;\r\n            if (message !== undefined && message !== null) {\r\n                if (extra !== undefined) {\r\n                    console.warn(message, extra);\r\n                } else {\r\n                    console.warn(message);\r\n                }\r\n            }\r\n        }\r\n\r\n        this._vertexShader = createShaderFromSource(glc, vertexSource, gl.VERTEX_SHADER);\r\n        this._fragmentShader = createShaderFromSource(glc, fragmentSource, gl.FRAGMENT_SHADER);\r\n        if (this._vertexShader === null || this._fragmentShader === null) {\r\n            return error(\"Vertex shader or fragment shader is null.\");\r\n        }\r\n        this._program = glc.createProgram();\r\n        if (this._program === null) {\r\n            return error(\"Failed to create program.\");\r\n        }\r\n        glc.attachShader(this._program, this._vertexShader);\r\n        glc.attachShader(this._program, this._fragmentShader);\r\n        glc.linkProgram(this._program);\r\n        var isLinked = glc.getProgramParameter(this._program, gl.LINK_STATUS);\r\n        if (!isLinked) {\r\n            var errorLog = glc.getProgramInfoLog(this._program);\r\n            return error(\"Failed to link program: \", errorLog);\r\n        }\r\n    }\r\n\r\n    private __syncUniform(uniform:UniformCache):void {\r\n        var location = uniform.location;\r\n        var value = uniform.value;\r\n        var glc = this._glc;\r\n        /**\r\n         * @type {Number}\r\n         */\r\n        var i = 0;\r\n        /**\r\n         * @type {Number}\r\n         */\r\n        var il = 0;\r\n        switch (uniform.type) {\r\n            case WebGLDataType.UBool:\r\n                glc.uniform1i(location, value ? 1 : 0);\r\n                break;\r\n            case WebGLDataType.U1I:\r\n                glc.uniform1i(location, value);\r\n                break;\r\n            case WebGLDataType.U1F:\r\n                glc.uniform1f(location, value);\r\n                break;\r\n            case WebGLDataType.U2F:\r\n                glc.uniform2f(location, value[0], value[1]);\r\n                break;\r\n            case WebGLDataType.U3F:\r\n                glc.uniform3f(location, value[0], value[1], value[2]);\r\n                break;\r\n            case WebGLDataType.U4F:\r\n                glc.uniform4f(location, value[0], value[1], value[2], value[3]);\r\n                break;\r\n            case WebGLDataType.UV2:\r\n                glc.uniform2f(location, value.x, value.y);\r\n                break;\r\n            case WebGLDataType.UV3:\r\n                glc.uniform3f(location, value.x, value.y, value.z);\r\n                break;\r\n            case WebGLDataType.UV4:\r\n                glc.uniform4f(location, value.x, value.y, value.z, value.w);\r\n                break;\r\n            case WebGLDataType.U1IV:\r\n                glc.uniform1iv(location, value);\r\n                break;\r\n            case WebGLDataType.U2IV:\r\n                glc.uniform2iv(location, value);\r\n                break;\r\n            case WebGLDataType.U3IV:\r\n                glc.uniform3iv(location, value);\r\n                break;\r\n            case WebGLDataType.U4IV:\r\n                glc.uniform4iv(location, value);\r\n                break;\r\n            case WebGLDataType.U1FV:\r\n                glc.uniform1fv(location, value);\r\n                break;\r\n            case WebGLDataType.U2FV:\r\n                glc.uniform2fv(location, value);\r\n                break;\r\n            case WebGLDataType.U3FV:\r\n                glc.uniform3fv(location, value);\r\n                break;\r\n            case WebGLDataType.U4FV:\r\n                glc.uniform4fv(location, value);\r\n                break;\r\n            case WebGLDataType.UMat2:\r\n                glc.uniformMatrix2fv(location, uniform.transpose, value);\r\n                break;\r\n            case WebGLDataType.UMat3:\r\n                glc.uniformMatrix3fv(location, uniform.transpose, value);\r\n                break;\r\n            case WebGLDataType.UMat4:\r\n                glc.uniformMatrix4fv(location, uniform.transpose, value);\r\n                break;\r\n            case WebGLDataType.UIV:\r\n                glc.uniform3iv(location, value);\r\n                break;\r\n            case WebGLDataType.UFV:\r\n                glc.uniform3fv(location, value);\r\n                break;\r\n            case WebGLDataType.UV2V:\r\n                if (!uniform.array) {\r\n                    uniform.array = new Float32Array(2 * value.length);\r\n                }\r\n                for (i = 0, il = value.length; i < il; i++) {\r\n                    uniform.array[i * 2] = value[i].x;\r\n                    uniform.array[i * 2 + 1] = value[i].y;\r\n                }\r\n                glc.uniform2fv(location, uniform.array);\r\n                break;\r\n            case WebGLDataType.UV3V:\r\n                if (!uniform.array) {\r\n                    uniform.array = new Float32Array(3 * value.length);\r\n                }\r\n                for (i = 0, il = value.length; i < il; i++) {\r\n                    uniform.array[i * 3] = value[i].x;\r\n                    uniform.array[i * 3 + 1] = value[i].y;\r\n                    uniform.array[i * 3 + 2] = value[i].z;\r\n                }\r\n                glc.uniform2fv(location, uniform.array);\r\n                break;\r\n            case WebGLDataType.UV4V:\r\n                if (!uniform.array) {\r\n                    uniform.array = new Float32Array(4 * value.length);\r\n                }\r\n                for (i = 0, il = value.length; i < il; i++) {\r\n                    uniform.array[i * 4] = value[i].x;\r\n                    uniform.array[i * 4 + 1] = value[i].y;\r\n                    uniform.array[i * 4 + 2] = value[i].z;\r\n                    uniform.array[i * 4 + 3] = value[i].w;\r\n                }\r\n                glc.uniform2fv(location, uniform.array);\r\n                break;\r\n            case WebGLDataType.USampler2D:\r\n                glc.activeTexture(gl[\"TEXTURE\" + value.toString()]);\r\n                glc.bindTexture(gl.TEXTURE_2D, uniform.texture);\r\n                glc.uniform1i(location, value);\r\n                break;\r\n            default:\r\n                console.warn(\"Uniform [\" + uniform.name + \"]: unknown format \" + uniform.type);\r\n                break;\r\n        }\r\n    }\r\n\r\n    private __cacheUniformLocations():void {\r\n        var glc = this._glc;\r\n        var program = this._program;\r\n        this._uniforms.forEach((v, k):void => {\r\n            v.location = glc.getUniformLocation(program, k);\r\n        });\r\n    }\r\n\r\n    private __cacheAttributeLocations():void {\r\n        var glc = this._glc;\r\n        var program = this._program;\r\n        this._attributes.forEach((v, k):void => {\r\n            v.location = glc.getAttribLocation(program, k);\r\n        });\r\n    }\r\n\r\n    protected __localInit(manager:ShaderManager, uniforms:Map<string, UniformCache>, attributes:Map<string, AttributeCache>):void {\r\n    }\r\n\r\n    protected _shaderManager:ShaderManager = null;\r\n    protected _vertexSource:string = null;\r\n    protected _fragmentSource:string = null;\r\n    protected _vertexShader:WebGLShader = null;\r\n    protected _fragmentShader:WebGLShader = null;\r\n    protected _program:WebGLProgram = null;\r\n    protected _uniforms:Map<string, UniformCache> = null;\r\n    protected _attributes:Map<string, AttributeCache> = null;\r\n    protected _id:number = -1;\r\n    protected _glc:WebGLRenderingContext = null;\r\n\r\n}\r\n\r\nfunction createShaderFromSource(glc:WebGLRenderingContext, source:string, type:number):WebGLShader {\r\n    var shader = glc.createShader(type);\r\n    if (shader === null) {\r\n        console.warn(\"Cannot create shader.\");\r\n        return null;\r\n    }\r\n    glc.shaderSource(shader, source);\r\n    glc.compileShader(shader);\r\n    var isCompiled = glc.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if (!isCompiled) {\r\n        var error = glc.getShaderInfoLog(shader);\r\n        console.warn(\"Failed to load shader: \" + error);\r\n        glc.deleteShader(shader);\r\n        return null;\r\n    }\r\n    return shader;\r\n}"],"sourceRoot":"/source/"}