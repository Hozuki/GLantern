{"version":3,"sources":["webgl/ShaderBase.ts"],"names":["ShaderBase","ShaderBase.constructor","ShaderBase.id","ShaderBase.dispose","ShaderBase.syncUniforms","ShaderBase.changeValue","ShaderBase.select","ShaderBase.getUniformLocation","ShaderBase.getAttributeLocation","ShaderBase.vertexSource","ShaderBase.fragmentSource","ShaderBase.___initialize","ShaderBase.___initialize.error","ShaderBase.___syncUniform","ShaderBase.___cacheUniformLocations","ShaderBase.___cacheAttributeLocations","ShaderBase.___localInit","createShaderFromSource"],"mappings":"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AAYA,CAACA,CAACA,GAAGA,KAAKA,CAACA,MAAMA,CAACA,CAACA;gBACvDA,CAACA;gBACDA,GAAGA,CAACA,CAACA,CAACA,GAAGA,CAACA,EAAEA,EAAEA,GAAGA,KAAKA,CAACA,MAAMA,EAAEA,CAACA,GAAGA,EAAEA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;oBACzCA,OAAOA,CAACA,KAAKA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,KAAKA,CAACA,CAACA,CAACA,CAACA,CAACA,CAACA;oBAClCA,OAAOA,CAACA,KAAKA,CAACA,CAACA,GAAGA,CAACA,GAAGA,CAACA,CAACA,GAAGA,KAAKA,CAACA,CAACA,CAACA,CAACA,CAACA,CAACA;oBACtCA,OAAOA,CAACA,KAAKA,CAACA,CAACA,GAAGA,CAACA,GAAGA,CAACA,CAACA,GAAGA,KAAKA,CAACA,CAACA,CAACA,CAACA,CAACA,CAACA;gBAC1CA,CAACA;gBACDA,GAAGA,CAACA,UAAUA,CAACA,QAAQA,EAAEA,OAAOA,CAACA,KAAKA,CAACA,CAACA;gBACxCA,KAAKA,CAACA;YACVA,KAAKA,6BAAaA,CAACA,IAAIA;gBACnBA,EAAEA,CAACA,CAACA,CAACA,OAAOA,CAACA,KAAKA,CAACA,CAACA,CAACA;oBACjBA,OAAOA,CAACA,KAAKA,GAAGA,IAAIA,YAAYA,CAACA,CAACA,GAAGA,KAAKA,CAACA,MAAMA,CAACA,CAACA;gBACvDA,CAACA;gBACDA,GAAGA,CAACA,CAACA,CAACA,GAAGA,CAACA,EAAEA,EAAEA,GAAGA,KAAKA,CAACA,MAAMA,EAAEA,CAACA,GAAGA,EAAEA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;oBACzCA,OAAOA,CAACA,KAAKA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,KAAKA,CAACA,CAACA,CAACA,CAACA,CAACA,CAACA;oBAClCA,OAAOA,CAACA,KAAKA,CAACA,CAACA,GAAGA,CAACA,GAAGA,CAACA,CAACA,GAAGA,KAAKA,CAACA,CAACA,CAACA,CAACA,CAACA,CAACA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","file":"webgl/ShaderBase.js","sourcesContent":["/**\r\n * Created by MIC on 2015/11/18.\r\n */\r\n\r\nimport {AttributeCache} from \"./AttributeCache\";\r\nimport {UniformCache} from \"./UniformCache\";\r\nimport {ShaderManager} from \"./ShaderManager\";\r\nimport {VertexShaders} from \"./VertexShaders\";\r\nimport {FragmentShaders} from \"./FragmentShaders\";\r\nimport {IDisposable} from \"../IDisposable\";\r\nimport {WebGLDataType} from \"./WebGLDataType\";\r\nimport {_util} from \"../_util/_util\";\r\n\r\nvar gl = (<any>this).WebGLRenderingContext || (<any>window).WebGLRenderingContext;\r\n\r\nexport class ShaderBase implements IDisposable {\r\n\r\n    constructor(manager:ShaderManager, vertexSource:string, fragmentSource:string,\r\n                uniforms:Map<string, UniformCache>, attributes:Map<string, AttributeCache>) {\r\n        this._shaderManager = manager;\r\n        this._vertexSource = vertexSource;\r\n        this._fragmentSource = fragmentSource;\r\n        this._id = manager.getNextAvailableID();\r\n        this.__initialize(manager.context, vertexSource, fragmentSource);\r\n        this.select();\r\n        if (_util.isUndefinedOrNull(uniforms) || _util.isUndefinedOrNull(attributes)) {\r\n            this._uniforms = new Map<string, UniformCache>();\r\n            this._attributes = new Map<string, AttributeCache>();\r\n            this.__localInit(manager, this._uniforms, this._attributes);\r\n        } else {\r\n            this._uniforms = uniforms;\r\n            this._attributes = attributes;\r\n        }\r\n        this.__cacheUniformLocations();\r\n        this.__cacheAttributeLocations();\r\n        this.syncUniforms();\r\n    }\r\n\r\n    get id():number {\r\n        return this._id;\r\n    }\r\n\r\n    dispose():void {\r\n        var glc = this._glc;\r\n        glc.deleteProgram(this._program);\r\n        glc.deleteShader(this._vertexShader);\r\n        glc.deleteShader(this._fragmentShader);\r\n        this._glc = null;\r\n        this._uniforms = null;\r\n        this._attributes = null;\r\n        this._vertexShader = null;\r\n        this._fragmentShader = null;\r\n        this._vertexSource = null;\r\n        this._fragmentSource = null;\r\n        this._shaderManager = null;\r\n    }\r\n\r\n    syncUniforms():void {\r\n        this._uniforms.forEach((v):void => {\r\n            this.__syncUniform(v);\r\n        });\r\n    }\r\n\r\n    changeValue(name:string, callback:(uniform:UniformCache) => void):void {\r\n        var uniform = this._uniforms.get(name);\r\n        if (uniform !== undefined && uniform !== null) {\r\n            callback(uniform);\r\n        }\r\n    }\r\n\r\n    select():void {\r\n        this._glc.useProgram(this._program);\r\n    }\r\n\r\n    getUniformLocation(name:string):WebGLUniformLocation {\r\n        return this._program !== null ? this._glc.getUniformLocation(this._program, name) : null;\r\n    }\r\n\r\n    getAttributeLocation(name:string):number {\r\n        return this._program !== null ? this._glc.getAttribLocation(this._program, name) : -1;\r\n    }\r\n\r\n    get vertexSource():string {\r\n        return this._vertexSource\r\n    }\r\n\r\n    get fragmentSource():string {\r\n        return this._fragmentSource;\r\n    }\r\n\r\n    static SHADER_CLASS_NAME:string = \"ShaderBase\";\r\n    static FRAGMENT_SOURCE:string = FragmentShaders.buffered;\r\n    static VERTEX_SOURCE:string = VertexShaders.buffered;\r\n\r\n    private __initialize(glc:WebGLRenderingContext, vertexSource:string, fragmentSource:string):void {\r\n        this._glc = glc;\r\n\r\n        function error(message:string, extra?:any):void {\r\n            if (this._vertexShader !== null) {\r\n                glc.deleteShader(this._vertexShader);\r\n            }\r\n            if (this._fragmentShader !== null) {\r\n                glc.deleteShader(this._fragmentShader);\r\n            }\r\n            if (this._program !== null) {\r\n                glc.deleteProgram(this._program);\r\n            }\r\n            this._vertexShader = this._fragmentShader = this._program = null;\r\n            if (message !== undefined && message !== null) {\r\n                if (extra !== undefined) {\r\n                    console.warn(message, extra);\r\n                } else {\r\n                    console.warn(message);\r\n                }\r\n            }\r\n        }\r\n\r\n        this._vertexShader = createShaderFromSource(glc, vertexSource, gl.VERTEX_SHADER);\r\n        this._fragmentShader = createShaderFromSource(glc, fragmentSource, gl.FRAGMENT_SHADER);\r\n        if (this._vertexShader === null || this._fragmentShader === null) {\r\n            return error(\"Vertex shader or fragment shader is null.\");\r\n        }\r\n        this._program = glc.createProgram();\r\n        if (this._program === null) {\r\n            return error(\"Failed to create program.\");\r\n        }\r\n        glc.attachShader(this._program, this._vertexShader);\r\n        glc.attachShader(this._program, this._fragmentShader);\r\n        glc.linkProgram(this._program);\r\n        var isLinked = glc.getProgramParameter(this._program, gl.LINK_STATUS);\r\n        if (!isLinked) {\r\n            var errorLog = glc.getProgramInfoLog(this._program);\r\n            return error(\"Failed to link program: \", errorLog);\r\n        }\r\n    }\r\n\r\n    private __syncUniform(uniform:UniformCache):void {\r\n        var location = uniform.location;\r\n        var value = uniform.value;\r\n        var glc = this._glc;\r\n        /**\r\n         * @type {Number}\r\n         */\r\n        var i = 0;\r\n        /**\r\n         * @type {Number}\r\n         */\r\n        var il = 0;\r\n        switch (uniform.type) {\r\n            case WebGLDataType.UBool:\r\n                glc.uniform1i(location, value ? 1 : 0);\r\n                break;\r\n            case WebGLDataType.U1I:\r\n                glc.uniform1i(location, value);\r\n                break;\r\n            case WebGLDataType.U1F:\r\n                glc.uniform1f(location, value);\r\n                break;\r\n            case WebGLDataType.U2F:\r\n                glc.uniform2f(location, value[0], value[1]);\r\n                break;\r\n            case WebGLDataType.U3F:\r\n                glc.uniform3f(location, value[0], value[1], value[2]);\r\n                break;\r\n            case WebGLDataType.U4F:\r\n                glc.uniform4f(location, value[0], value[1], value[2], value[3]);\r\n                break;\r\n            case WebGLDataType.UV2:\r\n                glc.uniform2f(location, value.x, value.y);\r\n                break;\r\n            case WebGLDataType.UV3:\r\n                glc.uniform3f(location, value.x, value.y, value.z);\r\n                break;\r\n            case WebGLDataType.UV4:\r\n                glc.uniform4f(location, value.x, value.y, value.z, value.w);\r\n                break;\r\n            case WebGLDataType.U1IV:\r\n                glc.uniform1iv(location, value);\r\n                break;\r\n            case WebGLDataType.U2IV:\r\n                glc.uniform2iv(location, value);\r\n                break;\r\n            case WebGLDataType.U3IV:\r\n                glc.uniform3iv(location, value);\r\n                break;\r\n            case WebGLDataType.U4IV:\r\n                glc.uniform4iv(location, value);\r\n                break;\r\n            case WebGLDataType.U1FV:\r\n                glc.uniform1fv(location, value);\r\n                break;\r\n            case WebGLDataType.U2FV:\r\n                glc.uniform2fv(location, value);\r\n                break;\r\n            case WebGLDataType.U3FV:\r\n                glc.uniform3fv(location, value);\r\n                break;\r\n            case WebGLDataType.U4FV:\r\n                glc.uniform4fv(location, value);\r\n                break;\r\n            case WebGLDataType.UMat2:\r\n                glc.uniformMatrix2fv(location, uniform.transpose, value);\r\n                break;\r\n            case WebGLDataType.UMat3:\r\n                glc.uniformMatrix3fv(location, uniform.transpose, value);\r\n                break;\r\n            case WebGLDataType.UMat4:\r\n                glc.uniformMatrix4fv(location, uniform.transpose, value);\r\n                break;\r\n            case WebGLDataType.UIV:\r\n                glc.uniform3iv(location, value);\r\n                break;\r\n            case WebGLDataType.UFV:\r\n                glc.uniform3fv(location, value);\r\n                break;\r\n            case WebGLDataType.UV2V:\r\n                if (!uniform.array) {\r\n                    uniform.array = new Float32Array(2 * value.length);\r\n                }\r\n                for (i = 0, il = value.length; i < il; i++) {\r\n                    uniform.array[i * 2] = value[i].x;\r\n                    uniform.array[i * 2 + 1] = value[i].y;\r\n                }\r\n                glc.uniform2fv(location, uniform.array);\r\n                break;\r\n            case WebGLDataType.UV3V:\r\n                if (!uniform.array) {\r\n                    uniform.array = new Float32Array(3 * value.length);\r\n                }\r\n                for (i = 0, il = value.length; i < il; i++) {\r\n                    uniform.array[i * 3] = value[i].x;\r\n                    uniform.array[i * 3 + 1] = value[i].y;\r\n                    uniform.array[i * 3 + 2] = value[i].z;\r\n                }\r\n                glc.uniform2fv(location, uniform.array);\r\n                break;\r\n            case WebGLDataType.UV4V:\r\n                if (!uniform.array) {\r\n                    uniform.array = new Float32Array(4 * value.length);\r\n                }\r\n                for (i = 0, il = value.length; i < il; i++) {\r\n                    uniform.array[i * 4] = value[i].x;\r\n                    uniform.array[i * 4 + 1] = value[i].y;\r\n                    uniform.array[i * 4 + 2] = value[i].z;\r\n                    uniform.array[i * 4 + 3] = value[i].w;\r\n                }\r\n                glc.uniform2fv(location, uniform.array);\r\n                break;\r\n            case WebGLDataType.USampler2D:\r\n                glc.activeTexture(gl[\"TEXTURE\" + value.toString()]);\r\n                glc.bindTexture(gl.TEXTURE_2D, uniform.texture);\r\n                glc.uniform1i(location, value);\r\n                break;\r\n            default:\r\n                console.warn(\"Uniform [\" + uniform.name + \"]: unknown format \" + uniform.type);\r\n                break;\r\n        }\r\n    }\r\n\r\n    private __cacheUniformLocations():void {\r\n        var glc = this._glc;\r\n        var program = this._program;\r\n        this._uniforms.forEach((v, k):void => {\r\n            v.location = glc.getUniformLocation(program, k);\r\n        });\r\n    }\r\n\r\n    private __cacheAttributeLocations():void {\r\n        var glc = this._glc;\r\n        var program = this._program;\r\n        this._attributes.forEach((v, k):void => {\r\n            v.location = glc.getAttribLocation(program, k);\r\n        });\r\n    }\r\n\r\n    protected __localInit(manager:ShaderManager, uniforms:Map<string, UniformCache>, attributes:Map<string, AttributeCache>):void {\r\n    }\r\n\r\n    protected _shaderManager:ShaderManager = null;\r\n    protected _vertexSource:string = null;\r\n    protected _fragmentSource:string = null;\r\n    protected _vertexShader:WebGLShader = null;\r\n    protected _fragmentShader:WebGLShader = null;\r\n    protected _program:WebGLProgram = null;\r\n    protected _uniforms:Map<string, UniformCache> = null;\r\n    protected _attributes:Map<string, AttributeCache> = null;\r\n    protected _id:number = -1;\r\n    protected _glc:WebGLRenderingContext = null;\r\n\r\n}\r\n\r\nfunction createShaderFromSource(glc:WebGLRenderingContext, source:string, type:number):WebGLShader {\r\n    var shader = glc.createShader(type);\r\n    if (shader === null) {\r\n        console.warn(\"Cannot create shader.\");\r\n        return null;\r\n    }\r\n    glc.shaderSource(shader, source);\r\n    glc.compileShader(shader);\r\n    var isCompiled = glc.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if (!isCompiled) {\r\n        var error = glc.getShaderInfoLog(shader);\r\n        console.warn(\"Failed to load shader: \" + error);\r\n        glc.deleteShader(shader);\r\n        return null;\r\n    }\r\n    return shader;\r\n}"],"sourceRoot":"/source/"}