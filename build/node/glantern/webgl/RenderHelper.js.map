{"version":3,"sources":["glantern/webgl/renderhelper.ts"],"names":["RenderHelper","RenderHelper.constructor","RenderHelper.renderPrimitives","RenderHelper.renderPrimitives2","RenderHelper.copyTargetContent","RenderHelper.copyImageContent","RenderHelper.renderImage","RenderHelper.renderBuffered","___checkRenderTargets"],"mappings":"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","file":"glantern/webgl/RenderHelper.js","sourcesContent":["/**\r\n * Created by MIC on 2015/11/18.\r\n */\r\n\r\nimport {RenderTarget2D} from \"./RenderTarget2D\";\r\nimport {PackedArrayBuffer} from \"./PackedArrayBuffer\";\r\nimport {WebGLRenderer} from \"./WebGLRenderer\";\r\nimport {ReplicateShader} from \"./shaders/ReplicateShader\";\r\nimport {ShaderID} from \"./ShaderID\";\r\nimport {BufferedShader} from \"./shaders/BufferedShader\";\r\nimport {Matrix3D} from \"../flash/geom/Matrix3D\";\r\nimport {CopyImageShader} from \"./shaders/CopyImageShader\";\r\nimport {Primitive2Shader} from \"./shaders/Primitive2Shader\";\r\nimport {PrimitiveShader} from \"./shaders/PrimitiveShader\";\r\nimport {GLUtil} from \"../../../lib/glantern-utils/src/GLUtil\";\r\n\r\nvar gl = (<any>this).WebGLRenderingContext || (<any>window).WebGLRenderingContext;\r\n\r\nexport abstract class RenderHelper {\r\n\r\n    static renderPrimitives(renderer:WebGLRenderer, renderTo:RenderTarget2D, vertices:PackedArrayBuffer, colors:PackedArrayBuffer, indices:PackedArrayBuffer, clearOutput:boolean):void {\r\n        renderer.shaderManager.selectShader(ShaderID.PRIMITIVE);\r\n\r\n        var shader = <PrimitiveShader>renderer.shaderManager.currentShader;\r\n        var glc = renderer.context;\r\n        var attributeLocation:number;\r\n\r\n        renderTo.activate();\r\n        shader.syncUniforms();\r\n\r\n        vertices.syncBufferData();\r\n        attributeLocation = shader.getAttributeLocation(\"aVertexPosition\");\r\n        glc.vertexAttribPointer(attributeLocation, 3, vertices.elementGLType, false, vertices.elementSize * 3, 0);\r\n        glc.enableVertexAttribArray(attributeLocation);\r\n\r\n        colors.syncBufferData();\r\n        attributeLocation = shader.getAttributeLocation(\"aVertexColor\");\r\n        glc.vertexAttribPointer(attributeLocation, 4, colors.elementGLType, false, colors.elementSize * 4, 0);\r\n        glc.enableVertexAttribArray(attributeLocation);\r\n\r\n        indices.syncBufferData();\r\n\r\n        if (clearOutput) {\r\n            renderTo.clear();\r\n        }\r\n        glc.viewport(0, 0, renderTo.originalWidth, renderTo.originalHeight);\r\n        glc.drawElements(gl.TRIANGLES, indices.elementCount, indices.elementGLType, 0);\r\n    }\r\n\r\n    static renderPrimitives2(renderer:WebGLRenderer, renderTo:RenderTarget2D, vertices:PackedArrayBuffer, colors:PackedArrayBuffer, indices:PackedArrayBuffer,\r\n                             flipX:boolean, flipY:boolean, clearOutput:boolean):void {\r\n        renderer.shaderManager.selectShader(ShaderID.PRIMITIVE2);\r\n\r\n        var shader = <Primitive2Shader>renderer.shaderManager.currentShader;\r\n        var glc = renderer.context;\r\n        var attributeLocation:number;\r\n\r\n        renderTo.activate();\r\n        shader.setOriginalSize([renderTo.originalWidth, renderTo.originalHeight]);\r\n        shader.setFlipX(flipX);\r\n        shader.setFlipY(flipY);\r\n        shader.syncUniforms();\r\n\r\n        vertices.syncBufferData();\r\n        attributeLocation = shader.getAttributeLocation(\"aVertexPosition\");\r\n        glc.vertexAttribPointer(attributeLocation, 3, vertices.elementGLType, false, vertices.elementSize * 3, 0);\r\n        glc.enableVertexAttribArray(attributeLocation);\r\n\r\n        colors.syncBufferData();\r\n        attributeLocation = shader.getAttributeLocation(\"aVertexColor\");\r\n        glc.vertexAttribPointer(attributeLocation, 4, colors.elementGLType, false, colors.elementSize * 4, 0);\r\n        glc.enableVertexAttribArray(attributeLocation);\r\n\r\n        indices.syncBufferData();\r\n\r\n        if (clearOutput) {\r\n            renderTo.clear();\r\n        }\r\n        glc.viewport(0, 0, renderTo.originalWidth, renderTo.originalHeight);\r\n        glc.drawElements(gl.TRIANGLES, indices.elementCount, indices.elementGLType, 0);\r\n    }\r\n\r\n\r\n    static copyTargetContent(renderer:WebGLRenderer, source:RenderTarget2D, destination:RenderTarget2D, flipX:boolean, flipY:boolean, clearOutput:boolean):void {\r\n        RenderHelper.renderBuffered(renderer, source, destination, ShaderID.REPLICATE, clearOutput, (r:WebGLRenderer):void => {\r\n            var shader = <ReplicateShader>r.shaderManager.currentShader;\r\n            shader.setFlipX(flipX);\r\n            shader.setFlipY(flipY);\r\n            if (flipX || flipY) {\r\n                shader.setOriginalSize([destination.originalWidth, destination.originalHeight]);\r\n                shader.setFitSize([destination.fitWidth, destination.fitHeight]);\r\n            }\r\n        });\r\n    }\r\n\r\n    static copyImageContent(renderer:WebGLRenderer, source:RenderTarget2D, destination:RenderTarget2D, flipX:boolean, flipY:boolean, transform:Matrix3D, alpha:number, clearOutput:boolean):void {\r\n        RenderHelper.renderBuffered(renderer, source, destination, ShaderID.COPY_IMAGE, clearOutput, (r:WebGLRenderer):void => {\r\n            var shader = <CopyImageShader>r.shaderManager.currentShader;\r\n            shader.setFlipX(flipX);\r\n            shader.setFlipY(flipY);\r\n            shader.setAlpha(alpha);\r\n            shader.setTransform(transform);\r\n            if (flipX || flipY) {\r\n                shader.setOriginalSize([destination.originalWidth, destination.originalHeight]);\r\n                shader.setFitSize([destination.fitWidth, destination.fitHeight]);\r\n            }\r\n        });\r\n    }\r\n\r\n    static renderImage(renderer:WebGLRenderer, source:RenderTarget2D, destination:RenderTarget2D, clearOutput:boolean):void {\r\n        RenderHelper.renderBuffered(renderer, source, destination, ShaderID.COPY_IMAGE, clearOutput, (r:WebGLRenderer):void => {\r\n            var shader = <CopyImageShader>r.shaderManager.currentShader;\r\n            shader.setFlipX(false);\r\n            shader.setFlipY(false);\r\n        });\r\n    }\r\n\r\n    static renderBuffered(renderer:WebGLRenderer, source:RenderTarget2D, destination:RenderTarget2D, shaderID:number,\r\n                          clearOutput:boolean, shaderInit:(r:WebGLRenderer) => void):void {\r\n        if (!__checkRenderTargets(source, destination)) {\r\n            return;\r\n        }\r\n\r\n        var glc = renderer.context;\r\n        renderer.shaderManager.selectShader(shaderID);\r\n        shaderInit(renderer);\r\n        var shader = <BufferedShader>renderer.shaderManager.currentShader;\r\n        // Target must have a 'uSampler' sample2D uniform\r\n        shader.setTexture(source.texture);\r\n        shader.syncUniforms();\r\n\r\n        if (RenderHelper._glVertexPositionBuffer === null) {\r\n            var vertexPositions = [\r\n                0, source.fitHeight, 0,\r\n                source.fitWidth, source.fitHeight, 0,\r\n                0, 0, 0,\r\n                source.fitWidth, 0, 0\r\n            ];\r\n            RenderHelper._glVertexPositionBuffer = PackedArrayBuffer.create(glc, vertexPositions, gl.FLOAT, gl.ARRAY_BUFFER);\r\n        }\r\n\r\n        var attributeLocation:number;\r\n\r\n        attributeLocation = shader.getAttributeLocation(\"aVertexPosition\");\r\n        if (attributeLocation >= 0) {\r\n            var glVertexPositionBuffer = RenderHelper._glVertexPositionBuffer;\r\n            glVertexPositionBuffer.syncBufferData();\r\n            glc.vertexAttribPointer(attributeLocation, 3, glVertexPositionBuffer.elementGLType, false, glVertexPositionBuffer.elementSize * 3, 0);\r\n            glc.enableVertexAttribArray(attributeLocation);\r\n        }\r\n\r\n        // Some shaders, e.g. the blur-2 shader, has no texture coordinates.\r\n        attributeLocation = shader.getAttributeLocation(\"aTextureCoord\");\r\n        if (attributeLocation >= 0) {\r\n            var textureCoords = RenderTarget2D.textureCoords;\r\n            textureCoords.syncBufferData();\r\n            glc.vertexAttribPointer(attributeLocation, 2, textureCoords.elementGLType, false, textureCoords.elementSize * 2, 0);\r\n            glc.enableVertexAttribArray(attributeLocation);\r\n        }\r\n\r\n        var textureIndices = RenderTarget2D.textureIndices;\r\n        textureIndices.syncBufferData();\r\n\r\n        destination.activate();\r\n        if (clearOutput) {\r\n            destination.clear();\r\n        }\r\n        glc.viewport(0, 0, destination.originalWidth, destination.originalHeight);\r\n        glc.enable(gl.SCISSOR_TEST);\r\n        glc.scissor(0, 0, source.originalWidth, source.originalHeight);\r\n        glc.drawElements(gl.TRIANGLES, textureIndices.elementCount, textureIndices.elementGLType, 0);\r\n        glc.disable(gl.SCISSOR_TEST);\r\n    }\r\n\r\n    // Be careful! Manually dispose it when the whole module is finalizing.\r\n    private static _glVertexPositionBuffer:PackedArrayBuffer = null;\r\n\r\n}\r\n\r\nfunction __checkRenderTargets(source:RenderTarget2D, destination:RenderTarget2D):boolean {\r\n    if (GLUtil.isUndefinedOrNull(source)) {\r\n        console.warn(\"Cannot render a null RenderTarget2D onto another RenderTarget2D.\");\r\n        return false;\r\n    }\r\n    if (source.texture === null) {\r\n        console.warn(\"Cannot use a RenderTarget2D without texture-based frame buffer to render onto another RenderTarget2D.\");\r\n        return false;\r\n    }\r\n    if (source.isRoot) {\r\n        console.warn(\"Cannot use a root RenderTarget2D as source.\");\r\n        return false;\r\n    }\r\n    if (source === destination) {\r\n        console.warn(\"Source and destination must not be the same RenderTarget2D.\");\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\n"],"sourceRoot":"/source/"}